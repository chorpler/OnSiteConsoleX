<ion-header>
  <ion-navbar>
    <ion-buttons left>
      <button ion-button menuToggle *ngIf="!modalMode && !data.currentlyOpeningPage">
        <ion-icon name="menu"></ion-icon>
      </button>
      <button type="button" ion-button icon-only (click)="cancelAndExitModal($event)" *ngIf="modalMode && !data.currentlyOpeningPage">
        <ion-icon name="close"></ion-icon>
      </button>
      <ion-spinner name="bubbles" [class.spinner-opening-page]="true" *ngIf="data.currentlyOpeningPage"></ion-spinner>
    </ion-buttons>
    <ion-title>
      <span class="page-title">{{title}}</span>
      <!-- <span class="report-count"> ({{reports?.length}} reports<span class="report-count-filtered" *ngIf="filteredCount">, {{filteredCount}} matches</span>)</span> -->
    </ion-title>
    <ion-buttons right>
      <span class="menubar-buttons">
        <span class="menubar-button" (click)="resetAllTables($event)" title="Reset all reports tables (clear filters, etc.)">
          <i class="fa fa-ban clear-button"></i>
        </span>
        <span class="menubar-button" title="Run Tech Shift Reports for visible reports" (click)="openTechShiftReports($event)">
          <i class="icomoon-shift-reports"></i>
        </span>
        <span class="menubar-button" title="Load old reports (can be slow)" (click)="downloadOldReports($event)">
          <i class="fa fa-database"></i>
        </span>
        <span class="menubar-button" title="Load all reports fresh from server" (click)="refreshData($event)">
          <i class="fa fa-refresh"></i>
        </span>
        <span class="menubar-button" title="Export Reports for Payroll" (click)="exportWorkReportsForPayroll($event)">
          <i class="icomoon-payroll"></i>
        </span>
        <span class="menubar-button" title="Export reports table to CSV file" (click)="exportReportsTableAsCSV($event)">
          <i class="fa fa-cloud-download"></i>
        </span>
        <span class="menubar-button" title="Copy reports list to clipboard (to paste in Excel, etc.)" (click)="copyTable($event)">
          <i class="fa fa-clipboard"></i>
        </span>
        <!-- <button class="menubar-button" ion-button icon-only (click)="resetReportsTable($event)" title="Reset reports table (clear filters, etc.)">
          <i class="fa fa-ban clear-button"></i>
        </button>
        <button class="menubar-button" ion-button icon-only title="Run Tech Shift Reports for visible reports" (click)="openTechShiftReports($event)">
          <i class="icomoon-shift-reports"></i>
        </button>
        <button class="menubar-button" ion-button icon-only title="Load old reports (can be slow)" (click)="downloadOldReports($event)">
          <i class="fa fa-database"></i>
        </button>
        <button class="menubar-button" ion-button icon-only title="Load all reports fresh from server" (click)="refreshData($event)">
          <i class="fa fa-refresh"></i>
        </button>
        <button class="menubar-button" ion-button icon-only title="Export Reports for Payroll" (click)="exportWorkReportsForPayroll($event)">
          <i class="icomoon-payroll"></i>
        </button>
        <button class="menubar-button" ion-button icon-only title="Export reports table to CSV file" (click)="exportReportsTableAsCSV($event)">
          <i class="fa fa-cloud-download"></i>
        </button>
        <button class="menubar-button" ion-button icon-only title="Copy reports list to clipboard (to paste in Excel, etc.)" (click)="copyTable($event)">
          <i class="fa fa-clipboard"></i>
        </button> -->
      </span>
    </ion-buttons>
  </ion-navbar>
</ion-header>

<!-- <ion-content padding *ngIf="dataReady && data.ready()"> -->
<ion-content padding #reportsContent id="reports-content" *ngIf="dataReady">
  <p-panel #reportsPanel id="panel-reports" [styleClass]="'reports-panel work-reports'" [toggleable]="true">
    <p-header>
      <span class="panel-header">
        <span class="button-left">
          <span class="panel-header-button db-download" title="Load work reports from database" (click)="possibleUpdateReports(TABLEINDEX.reports - 1, $event)"></span>
        </span>
        <span class="button-left">
          <span class="panel-header-button" title="Calculate total hours shown" (click)="calculateHoursShown($event)"><i class="fal fa-calculator-alt"></i></span>
        </span>
        <span class="button-left" *ngIf="data.status.role === 'dev'">
          <span class="panel-header-button button-dev" title="Change all selected reports (still in development)" (click)="bulkEdit(TABLEINDEX.reports, $event)"><i class="fal fa-pencil-ruler"></i></span>
        </span>
        <span class="panel-title">
          Work Reports<span class="report-count"> ({{reports?.length}} loaded<span class="report-count-filtered" *ngIf="filteredCount">, {{filteredCount}} matches</span>)</span>
        </span>
        <span class="button-right">
          <span class="panel-header-button right" title="Reset this table (clear filters, selected rows, etc.)" (click)="resetTable(TABLEINDEX.reports, $event)"><i class="fal fa-history"></i></span>
        </span>
      </span>
    </p-header>

    <div #printArea class="table-wrapper" id="print-area">

      <!-- Begin Reports table -->
      <!-- <p-table #dt [styleClass]="'reports-table'" [columns]="selectedColumns" [value]="reports" [resizableColumns]="true" [reorderableColumns]="colsReorder" [autoLayout]="autoLayout" [rows]="rowCount" [paginator]="showTableFoot" [pageLinks]="3" [rowsPerPageOptions]="pageSizeOptions" selectionMode="single" (onRowSelect)="onRowSelect($event)" sortMode="multiple" [multiSortMeta]="reportsMultiSortMeta"> -->
      <p-table #dt [styleClass]="'reports-table'" [columns]="selectedColumns" [value]="reports" [resizableColumns]="true" [reorderableColumns]="colsReorder" [autoLayout]="autoLayout" [rows]="rowCount" [paginator]="showTableFoot" [pageLinks]="3" [rowsPerPageOptions]="pageSizeOptions" selectionMode="multiple" [(selection)]="selectedReports" sortMode="multiple" [multiSortMeta]="reportsMultiSortMeta" [(contextMenuSelection)]="selectedReports" [contextMenu]="reportsCM1">

        <!-- Caption area (column multiselect, date range filter, global search input) -->
        <ng-template pTemplate="caption">
          <div class="table-caption">
            <div class="column-choose-wrapper">
              <p-multiSelect #columnSelect [styleClass]="'column-multiselect'" optionLabel="header" defaultLabel="Choose columns" [options]="cols" [(ngModel)]="selectedColumns" [selectedItemsLabel]="selectedLabel" (onChange)="selectionChanged($event)"></p-multiSelect>
            </div>
            <div class="caption-right">
              <div class="date-wrapper">
                <span class="date-range-calendar-wrapper">
                  <p-calendar #dateRangeCalendar [styleClass]="'date-range-calendar'" [(ngModel)]="dateRanges[TABLEINDEX.reports - 1]" (onSelect)="checkDateRange(TABLEINDEX.reports, dateRangeCalendar, $event)" (onClose)="checkDateRangeOnClose(TABLEINDEX.reports, dateRangeCalendar, $event)" selectionMode="range" readonlyInput="true" showOtherMonths="true" selectOtherMonths="true" showIcon="true" placeholder="Date Range" title="Filter reports by this date range"></p-calendar>
                </span>
                <!-- <span class="header-button" title="Clear date filters" (click)="clearDates(dt, $event)"><i class="fa fa-times"></i></span> -->
                <span class="header-button" title="Clear date filters" (click)="clearTableDates(TABLEINDEX.reports, dt, $event)"><i class="fa fa-times"></i></span>
              </div>
              <div class="global-filter-wrapper">
                <i class="global-filter-icon fa fa-search" style="margin:4px 4px 0 0"></i>
                <input #globalFilterInput class="global-filter-input" type="text" pInputText size="50" placeholder="Global Search" (input)="dt.filterGlobal($event.target.value, 'contains')" style="width:auto">
              </div>
            </div>
          </div>
        </ng-template>

        <!-- Header area (col name, col sort icons, filter fields) -->
        <ng-template pTemplate="header" let-columns>
          <tr [class.reports-table-header]="true">
            <th [class.header-col-button]="true" [ngStyle]="styleColEdit" *ngIf="showButtonCol"></th>
            <th *ngFor="let col of columns; let i=index" [class.header-col]="true" [ngClass]="col?.class" [pSortableColumn]="col?.field" [ngStyle]="col?.style" [title]="col?.tooltip" pResizableColumn>
              {{col?.header}}
              <p-sortIcon [field]="col?.field"></p-sortIcon>
            </th>
          </tr>
          <tr class="reports-table-filter-row" *ngIf="showFilterRow">
            <th [class.header-col-button]="true" *ngIf="showButtonCol"></th>
            <th *ngFor="let col of columns" [class.filter-col]="true" [ngClass]="col?.class" [title]="col?.tooltip">
              <input [class.reports-col-filter]="true" pInputText type="text" [placeholder]="col?.filterPlaceholder" (input)="dt.filter($event.target.value, col.field, 'contains')">
            </th>
          </tr>
        </ng-template>

        <!-- Report table body rows and columns (actual data) -->
        <ng-template pTemplate="body" let-rowData let-columns="columns" let-rowIndex="rowIndex">
          <tr [pSelectableRow]="rowData" [pSelectableRowIndex]="rowIndex">
            <td [class.button-col]="true" title="View work report" (click)="showReport(rowData, $event)" *ngIf="showButtonCol">
              <span class="icon-button-wrapper">
                <i class="fal fa-edit work-reports-button-icon"></i>
              </span>
            </td>
            <td *ngFor="let col of columns; let i=index" [class.body-col]="true" [ngClass]="col?.class" [ngStyle]="col?.style">
              <span class="cell-body-data notes-wrapper" [title]="rowData[col?.field]" *ngIf="col.field === 'notes'">
                {{rowData[col?.field]}}
              </span>
              <span class="cell-body-data" *ngIf="col.field !== 'notes' && col.format!=='HH:mm'">
                {{rowData[col?.field]}}
              </span>
              <span class="cell-body-data" *ngIf="col.field !== 'notes' && col.format==='HH:mm'">
                {{rowData[col?.field].format("HH:mm")}}
              </span>
            </td>
          </tr>
        </ng-template>

      </p-table>
      <!-- Table ended -->
    </div>
  </p-panel>

  <p-panel #othersPanel id="panel-others" [styleClass]="'reports-panel others'" [toggleable]="true">
    <p-header>
      <span class="panel-header">
        <span class="button-left">
          <span class="panel-header-button db-download" title="Load miscellaneous reports from database" (click)="possibleUpdateReports(TABLEINDEX.others, $event)"></span>
        </span>
        <span class="button-left">
          <span class="panel-header-button" title="Calculate total misc report hours shown" (click)="calculateMiscHoursShown($event)"><i class="fal fa-calculator-alt"></i></span>
        </span>
        <span class="button-left" *ngIf="data.status.role === 'dev'">
          <span class="panel-header-button button-dev" title="Change all selected misc. reports (still in development)" (click)="bulkEdit(TABLEINDEX.others, $event)"><i class="fal fa-pencil-ruler"></i></span>
        </span>
        <span class="panel-title">
          Misc Reports<span class="report-count"> ({{others?.length}} loaded<span class="report-count-filtered" *ngIf="filteredCountOthers">, {{filteredCountOthers}} matches</span>)</span>
        </span>
        <span class="button-right">
          <span class="panel-header-button right" title="Reset this table (clear filters, selected rows, etc.)" (click)="resetTable(TABLEINDEX.others, $event)"><i class="fal fa-history"></i></span>
        </span>
      </span>
    </p-header>
    <div #printAreaOthers class="table-wrapper" id="print-area-others">

      <!-- Begin Misc Reports table -->
      <!-- <p-table #othersTable [styleClass]="'others-table'" [columns]="selectedColumnsOthers" [value]="others" [resizableColumns]="true" [reorderableColumns]="colsReorder" [autoLayout]="autoLayout" [rows]="rowCount" [paginator]="showTableFoot" [pageLinks]="3" [rowsPerPageOptions]="pageSizeOptions" selectionMode="single" (onRowSelect)="onRowSelectOther($event)" sortMode="multiple" [multiSortMeta]="othersMultiSortMeta"> -->
      <p-table #othersTable [styleClass]="'others-table'" [columns]="selectedColumnsOthers" [value]="others" [resizableColumns]="true" [reorderableColumns]="colsReorder" [autoLayout]="autoLayout" [rows]="rowCount" [paginator]="showTableFoot" [pageLinks]="3" [rowsPerPageOptions]="pageSizeOptions" selectionMode="multiple" [(selection)]="selectedReportsOther"  sortMode="multiple" [multiSortMeta]="othersMultiSortMeta" [(contextMenuSelection)]="selectedReportsOther" [contextMenu]="reportsCM2">

        <!-- Caption area (column multiselect, date range filter, global search input) -->
        <ng-template pTemplate="caption">
          <div class="table-others-caption">
            <div class="column-choose-others-wrapper">
              <p-multiSelect #columnSelectOthers [styleClass]="'column-others-multiselect'" optionLabel="header" defaultLabel="Choose columns" [options]="colsOthers" [(ngModel)]="selectedColumnsOthers" [selectedItemsLabel]="selectedLabelOthers" (onChange)="selectionChangedOthers($event)"></p-multiSelect>
            </div>
            <div class="caption-right">
              <div class="date-wrapper">
                <span class="date-range-calendar-wrapper">
                  <p-calendar #dateRangeCalendarOthers [styleClass]="'date-range-calendar'" [(ngModel)]="dateRanges[TABLEINDEX.others - 1]" (onSelect)="checkDateRange(TABLEINDEX.others, dateRangeCalendarOthers, $event)" (onClose)="checkDateRangeOnClose(TABLEINDEX.others, dateRangeCalendarOthers, $event)" selectionMode="range" readonlyInput="true" showOtherMonths="true" selectOtherMonths="true" showIcon="true" placeholder="Date Range" title="Filter reports by this date range"></p-calendar>
                </span>
                <!-- <span class="header-button" title="Clear date filters" (click)="clearDates(othersTable, $event)"><i class="fa fa-times"></i></span> -->
                <span class="header-button" title="Clear date filters" (click)="clearTableDates(TABLEINDEX.others, othersTable, $event)"><i class="fa fa-times"></i></span>
              </div>
              <div class="global-filter-wrapper">
                <i class="global-filter-icon fa fa-search" style="margin:4px 4px 0 0"></i>
                <input #globalFilterInputOthers class="global-filter-input" type="text" pInputText size="50" placeholder="Global Search" (input)="othersTable.filterGlobal($event.target.value, 'contains')" style="width:auto">
              </div>
            </div>
          </div>
        </ng-template>

        <!-- Header area (col name, col sort icons, filter fields) -->
        <ng-template pTemplate="header" let-columns>
          <tr [class.reports-table-header]="true">
            <th [class.header-col-button]="true" [ngStyle]="styleColEdit" *ngIf="showButtonCol"></th>
            <th *ngFor="let col of columns; let i=index" [class.header-col]="true" [ngClass]="col?.class" [pSortableColumn]="col?.field" [ngStyle]="col?.style" [title]="col?.tooltip" pResizableColumn>
              {{col?.header}}
              <p-sortIcon [field]="col?.field"></p-sortIcon>
            </th>
          </tr>
          <tr class="reports-table-filter-row" *ngIf="showFilterRow">
            <th [class.header-col-button]="true" *ngIf="showButtonCol"></th>
            <th *ngFor="let col of columns" [class.filter-col]="true" [ngClass]="col?.class" [title]="col?.tooltip">
              <input [class.reports-col-filter]="true" pInputText type="text" [placeholder]="col?.filterPlaceholder" (input)="othersTable.filter($event.target.value, col.field, 'contains')">
            </th>
          </tr>
        </ng-template>

        <!-- Others table body rows and columns (actual data) -->
        <ng-template pTemplate="body" let-rowData let-columns="columns" let-rowIndex="rowIndex">
          <tr [pSelectableRow]="rowData" [pSelectableRowIndex]="rowIndex">
            <td [class.button-col]="true" title="View misc report" (click)="showReportOther(rowData, $event)" *ngIf="showButtonCol">
              <span class="icon-button-wrapper">
                <i class="fal fa-edit work-reports-button-icon"></i>
              </span>
            </td>
            <td *ngFor="let col of columns; let i=index" [class.body-col]="true" [ngClass]="col?.class" [ngStyle]="col?.style">
              <span class="cell-body-data notes-wrapper" [title]="rowData[col?.field]" *ngIf="col.field === 'notes'">
                {{rowData[col?.field]}}
              </span>
              <span class="cell-body-data" *ngIf="col.field !== 'notes' && !col?.format">
                {{rowData[col?.field]}}
              </span>
              <span class="cell-body-data" *ngIf="col.field !== 'notes' && col?.format">
                <!-- {{rowData[col?.field].format(col?.format)}} -->
                <!-- {{rowData[col?.field].getReportDateAsString(col?.format)}} -->
                {{getMomentString(rowData[col?.field], col?.format)}}
              </span>
            </td>
          </tr>
        </ng-template>

      </p-table>
      <!-- Table ended -->

    </div>
  </p-panel>

  <p-panel #logisticsPanel id="panel-logistics" [styleClass]="'reports-panel logistics'" [toggleable]="true">
    <p-header>
      <span class="panel-header">
        <span class="button-left">
          <span class="panel-header-button db-download" title="Load logistics reports from database" (click)="possibleUpdateReports(TABLEINDEX.logistics, $event)"></span>
        </span>
        <span class="button-left">
          <span class="panel-header-button" title="Calculate total logistics hours shown" (click)="calculateLogisticsHoursShown($event)"><i class="fal fa-calculator-alt"></i></span>
        </span>
        <span class="button-left">
          <span class="panel-header-button" title="Calculate total logistics miles shown" (click)="calculateLogisticsMilesShown($event)"><i class="fal fa-ruler"></i></span>
        </span>
        <span class="button-left" *ngIf="data.status.role === 'dev'">
          <span class="panel-header-button button-dev" title="Change all selected logistics reports (still in development)" (click)="bulkEdit(TABLEINDEX.logistics, $event)"><i class="fal fa-pencil-ruler"></i></span>
        </span>
        <span class="panel-title">
          Logistics Reports<span class="report-count"> ({{logistics?.length}} loaded<span class="report-count-filtered" *ngIf="filteredCountLogistics">, {{filteredCountLogistics}} matches</span>)</span>
        </span>
        <span class="button-right">
          <span class="panel-header-button right" title="Reset this table (clear filters, selected rows, etc.)" (click)="resetTable(TABLEINDEX.logistics, $event)"><i class="fal fa-history"></i></span>
        </span>
      </span>
    </p-header>
    <div #printAreaLogistics class="table-wrapper" id="print-area-logistics">

      <!-- Begin Logistics Reports table -->
      <!-- <p-table #logisticsTable [styleClass]="'logistics-table'" [columns]="selectedColumnsLogistics" [value]="logistics" [resizableColumns]="true" [reorderableColumns]="colsReorder" [autoLayout]="autoLayout" [rows]="rowCount" [paginator]="showTableFoot" [pageLinks]="3" [rowsPerPageOptions]="pageSizeOptions" selectionMode="single" (onRowSelect)="onRowSelectLogistics($event)" sortMode="multiple" [multiSortMeta]="logisticsMultiSortMeta"> -->
      <p-table #logisticsTable [styleClass]="'logistics-table'" [columns]="selectedColumnsLogistics" [value]="logistics" [resizableColumns]="true" [reorderableColumns]="colsReorder" [autoLayout]="autoLayout" [rows]="rowCount" [paginator]="showTableFoot" [pageLinks]="3" [rowsPerPageOptions]="pageSizeOptions" selectionMode="multiple" [(selection)]="selectedReportsLogistics"  sortMode="multiple" [multiSortMeta]="logisticsMultiSortMeta" [(contextMenuSelection)]="selectedReportsLogistics" [contextMenu]="reportsCM3">

        <!-- Caption area (column multiselect, date range filter, global search input) -->
        <ng-template pTemplate="caption">
          <div class="table-logistics-caption">
            <div class="column-choose-logistics-wrapper">
              <p-multiSelect #columnSelectLogistics [styleClass]="'column-logistics-multiselect'" optionLabel="header" defaultLabel="Choose columns" [options]="colsLogistics" [(ngModel)]="selectedColumnsLogistics" [selectedItemsLabel]="selectedLabelLogistics" (onChange)="selectionChangedLogistics($event)"></p-multiSelect>
            </div>
            <div class="caption-right">
              <div class="date-wrapper">
                <span class="date-range-calendar-wrapper">
                  <p-calendar #dateRangeCalendarLogistics [styleClass]="'date-range-calendar'" [(ngModel)]="dateRanges[TABLEINDEX.logistics - 1]" (onSelect)="checkDateRange(TABLEINDEX.logistics, dateRangeCalendarLogistics, $event)" (onClose)="checkDateRangeOnClose(TABLEINDEX.logistics, dateRangeCalendarLogistics, $event)" selectionMode="range" readonlyInput="true" showOtherMonths="true" selectOtherMonths="true" showIcon="true" placeholder="Date Range" title="Filter reports by this date range"></p-calendar>
                </span>
                <!-- <span class="header-button" title="Clear date filters" (click)="clearDates(logisticsTable, $event)"><i class="fa fa-times"></i></span> -->
                <span class="header-button" title="Clear date filters" (click)="clearTableDates(TABLEINDEX.logistics, logisticsTable, $event)"><i class="fa fa-times"></i></span>
              </div>
              <div class="global-filter-wrapper">
                <i class="global-filter-icon fa fa-search" style="margin:4px 4px 0 0"></i>
                <input #globalFilterInputLogistics class="global-filter-input" type="text" pInputText size="50" placeholder="Global Search" (input)="logisticsTable.filterGlobal($event.target.value, 'contains')" style="width:auto">
              </div>
            </div>
          </div>
        </ng-template>

        <!-- Header area (col name, col sort icons, filter fields) -->
        <ng-template pTemplate="header" let-columns>
          <tr [class.reports-table-header]="true">
            <th [class.header-col-button]="true" [ngStyle]="styleColEdit" *ngIf="showButtonCol"></th>
            <ng-container *ngFor="let col of columns; let i=index">
              <th [class.header-col]="true" [ngClass]="col?.class" [pSortableColumn]="col?.field" [ngStyle]="col?.style" [title]="col?.tooltip" pResizableColumn>
                {{col?.header}}
                <p-sortIcon [field]="col?.field"></p-sortIcon>
              </th>
            </ng-container>
          </tr>
          <tr class="reports-table-filter-row" *ngIf="showFilterRow">
            <th [class.header-col-button]="true" *ngIf="showButtonCol"></th>
            <ng-container *ngFor="let col of columns; let i=index">
              <th [class.filter-col]="true" [ngClass]="col?.class" [title]="col?.tooltip">
                <!-- <input [class.reports-col-filter]="true" pInputText type="text" [placeholder]="col?.filterPlaceholder" (input)="logisticsTable.filter($event.target.value, col.field, 'contains')" *ngIf="col.filter"> -->
                <input [class.reports-col-filter]="true" pInputText type="text" [placeholder]="col?.filterPlaceholder" (input)="logisticsTable.filter($event.target.value, col.field, 'contains')" *ngIf="col.filter">
                <input [class.reports-col-filter-disabled]="true" pInputText type="text" [placeholder]="'--'" [disabled]="true" *ngIf="!col.filter">
              </th>
            </ng-container>
          </tr>
        </ng-template>

        <!-- Logistics Reports table body rows and columns (actual data) -->
        <ng-template pTemplate="body" let-rowData let-columns="columns" let-rowIndex="rowIndex">
          <tr [pSelectableRow]="rowData" [pSelectableRowIndex]="rowIndex">
            <td [class.button-col]="true" title="View Logistics Report" (click)="showReportLogistics(rowData, $event)" *ngIf="showButtonCol">
              <span class="icon-button-wrapper">
                <i class="fal fa-edit work-reports-button-icon"></i>
              </span>
            </td>
            <td *ngFor="let col of columns; let i=index" [class.body-col]="true" [ngClass]="col?.class" [ngStyle]="col?.style">
              <span class="cell-body-data" *ngIf="col.type === 'location'">
                {{rowData[col?.field].getCoordinatesAsString()}}
              </span>
              <span class="cell-body-data notes-wrapper" [title]="rowData[col?.field]" *ngIf="col.field === 'notes'">
                {{rowData[col?.field]}}
              </span>
              <span class="cell-body-data" *ngIf="col.field !== 'notes' && !col?.type && !col?.format">
                {{rowData[col?.field]}}
              </span>
              <span class="cell-body-data" *ngIf="col.field !== 'notes' && !col?.type && col?.format">
                <!-- {{moment(rowData[col?.field]).format(col?.format)}} -->
                {{getMomentString(rowData[col?.field], col.format)}}
              </span>
            </td>
          </tr>
        </ng-template>

      </p-table>
      <!-- Table ended -->

    </div>
  </p-panel>

  <p-panel #maintenancesPanel id="panel-maintenances" [styleClass]="'reports-panel maintenances'" [toggleable]="true">
    <p-header>
      <span class="panel-header">
        <span class="button-left">
          <span class="panel-header-button db-download" title="Load maintenance reports from database" (click)="possibleUpdateReports(TABLEINDEX.maintenances, $event)"></span>
        </span>
        <span class="button-left">
          <span class="panel-header-button" title="Calculate total maintenance hours shown" (click)="calculateMaintenanceHoursShown($event)"><i class="fal fa-calculator-alt"></i></span>
        </span>
        <!-- <span class="button-left">
          <span class="panel-header-button" title="Calculate total maintenance miles shown" (click)="calculateMaintenanceMilesShown($event)"><i class="fal fa-ruler"></i></span>
        </span> -->
        <span class="button-left" *ngIf="data.status.role === 'dev'">
          <span class="panel-header-button button-dev" title="Change all selected maintenance reports (still in development)" (click)="bulkEdit(TABLEINDEX.maintenances, $event)"><i class="fal fa-pencil-ruler"></i></span>
        </span>
        <span class="panel-title">
          Maintenance Reports<span class="report-count"> ({{maintenances?.length}} loaded<span class="report-count-filtered" *ngIf="filteredCountMaintenance">, {{filteredCountMaintenance}} matches</span>)</span>
        </span>
        <span class="button-right">
          <span class="panel-header-button right" title="Reset this table (clear filters, selected rows, etc.)" (click)="resetTable(TABLEINDEX.maintenances, $event)"><i class="fal fa-history"></i></span>
        </span>
      </span>
    </p-header>
    <div #printAreaMaintenances class="table-wrapper" id="print-area-maintenances">

      <!-- Begin Maintenance Reports table -->
      <!-- <p-table #maintenancesTable [styleClass]="'maintenances-table'" [columns]="selectedColumnsMaintenance" [value]="maintenances" [resizableColumns]="true" [reorderableColumns]="colsReorder" [autoLayout]="autoLayout" [rows]="rowCount" [paginator]="showTableFoot" [pageLinks]="3" [rowsPerPageOptions]="pageSizeOptions" selectionMode="single" (onRowSelect)="onRowSelectMaintenance($event)" sortMode="multiple" [multiSortMeta]="maintenancesMultiSortMeta"> -->
      <p-table #maintenancesTable [styleClass]="'maintenances-table'" [columns]="selectedColumnsMaintenance" [value]="maintenances" [resizableColumns]="true" [reorderableColumns]="colsReorder" [autoLayout]="autoLayout" [rows]="rowCount" [paginator]="showTableFoot" [pageLinks]="3" [rowsPerPageOptions]="pageSizeOptions" selectionMode="multiple" [(selection)]="selectedReportsMaintenance"  sortMode="multiple" [multiSortMeta]="maintenancesMultiSortMeta" [(contextMenuSelection)]="selectedReportsMaintenance" [contextMenu]="reportsCM4">

        <!-- Caption area (column multiselect, date range filter, global search input) -->
        <ng-template pTemplate="caption">
          <div class="table-maintenances-caption">
            <div class="column-choose-maintenances-wrapper">
              <p-multiSelect #columnSelectMaintenance [styleClass]="'column-maintenances-multiselect'" optionLabel="header" defaultLabel="Choose columns" [options]="colsMaintenance" [(ngModel)]="selectedColumnsMaintenance" [selectedItemsLabel]="selectedLabelMaintenance" (onChange)="selectionChangedMaintenance($event)"></p-multiSelect>
            </div>
            <div class="caption-right">
              <div class="date-wrapper">
                <span class="date-range-calendar-wrapper">
                  <p-calendar #dateRangeCalendarMaintenance [styleClass]="'date-range-calendar'" [(ngModel)]="dateRanges[TABLEINDEX.maintenances - 1]" (onSelect)="checkDateRange(TABLEINDEX.maintenances, dateRangeCalendarMaintenance, $event)" (onClose)="checkDateRangeOnClose(TABLEINDEX.maintenances, dateRangeCalendarMaintenance, $event)" selectionMode="range" readonlyInput="true" showOtherMonths="true" selectOtherMonths="true" showIcon="true" placeholder="Date Range" title="Filter reports by this date range"></p-calendar>
                </span>
                <!-- <span class="header-button" title="Clear date filters" (click)="clearDates(maintenancesTable, $event)"><i class="fa fa-times"></i></span> -->
                <span class="header-button" title="Clear date filters" (click)="clearTableDates(TABLEINDEX.maintenances, maintenancesTable, $event)"><i class="fa fa-times"></i></span>
              </div>
              <div class="global-filter-wrapper">
                <i class="global-filter-icon fa fa-search" style="margin:4px 4px 0 0"></i>
                <input #globalFilterInputMaintenance class="global-filter-input" type="text" pInputText size="50" placeholder="Global Search" (input)="maintenancesTable.filterGlobal($event.target.value, 'contains')" style="width:auto">
              </div>
            </div>
          </div>
        </ng-template>

        <!-- Header area (col name, col sort icons, filter fields) -->
        <ng-template pTemplate="header" let-columns>
          <tr [class.reports-table-header]="true">
            <th [class.header-col-button]="true" [ngStyle]="styleColEdit" *ngIf="showButtonCol"></th>
            <ng-container *ngFor="let col of columns; let i=index">
              <th [class.header-col]="true" [ngClass]="col?.class" [pSortableColumn]="col?.field" [ngStyle]="col?.style" [title]="col?.tooltip" pResizableColumn>
                {{col?.header}}
                <p-sortIcon [field]="col?.field"></p-sortIcon>
              </th>
            </ng-container>
          </tr>
          <tr class="reports-table-filter-row" *ngIf="showFilterRow">
            <th [class.header-col-button]="true" *ngIf="showButtonCol"></th>
            <ng-container *ngFor="let col of columns; let i=index">
              <th [class.filter-col]="true" [ngClass]="col?.class" [title]="col?.tooltip">
                <!-- <input [class.reports-col-filter]="true" pInputText type="text" [placeholder]="col?.filterPlaceholder" (input)="maintenancesTable.filter($event.target.value, col.field, 'contains')" *ngIf="col.filter"> -->
                <input [class.reports-col-filter]="true" pInputText type="text" [placeholder]="col?.filterPlaceholder" (input)="maintenancesTable.filter($event.target.value, col.field, 'contains')" *ngIf="col.filter">
                <input [class.reports-col-filter-disabled]="true" pInputText type="text" [placeholder]="'--'" [disabled]="true" *ngIf="!col.filter">
              </th>
            </ng-container>
          </tr>
        </ng-template>

        <!-- Maintenance Reports table body rows and columns (actual data) -->
        <ng-template pTemplate="body" let-rowData let-columns="columns" let-rowIndex="rowIndex">
          <tr [pSelectableRow]="rowData" [pSelectableRowIndex]="rowIndex">
            <td [class.button-col]="true" title="View Maintenance Report" (click)="showReportMaintenance(rowData, $event)" *ngIf="showButtonCol">
              <span class="icon-button-wrapper">
                <i class="fal fa-edit work-reports-button-icon"></i>
              </span>
            </td>
            <td *ngFor="let col of columns; let i=index" [class.body-col]="true" [ngClass]="col?.class" [ngStyle]="col?.style">
              <span class="cell-body-data notes-wrapper" [title]="rowData[col?.field]" *ngIf="col.field === 'notes'">
                {{rowData[col?.field]}}
              </span>
              <span class="cell-body-data" *ngIf="col.field !== 'notes' && !col?.type && !col?.format">
                {{rowData[col?.field]}}
              </span>
              <span class="cell-body-data" *ngIf="col.field !== 'notes' && !col?.type && col?.format">
                <!-- {{moment(rowData[col?.field]).format(col?.format)}} -->
                {{getMomentString(rowData[col?.field], col.format)}}
              </span>
            </td>
          </tr>
        </ng-template>

      </p-table>
      <!-- Table ended -->

    </div>
  </p-panel>

  <p-panel #timecardsPanel id="panel-timecards" [styleClass]="'reports-panel timecards'" [toggleable]="true">
    <p-header>
      <span class="panel-header">
        <span class="button-left">
          <span class="panel-header-button db-download" title="Load time cards from database" (click)="possibleUpdateReports(TABLEINDEX.timecards, $event)"></span>
        </span>
        <span class="button-left">
          <span class="panel-header-button" title="Calculate total timecard hours shown" (click)="calculateTimeCardHoursShown($event)"><i class="fal fa-calculator-alt"></i></span>
        </span>
        <span class="button-left" *ngIf="data.status.role === 'dev'">
          <span class="panel-header-button button-dev" title="Change all selected time card reports (still in development)" (click)="bulkEdit(TABLEINDEX.timecards, $event)"><i class="fal fa-pencil-ruler"></i></span>
        </span>
        <span class="panel-title">
          Time Cards<span class="report-count"> ({{timecards?.length}} loaded<span class="report-count-filtered" *ngIf="filteredCountTimeCards">, {{filteredCountTimeCards}} matches</span>)</span>
        </span>
        <span class="button-right">
          <span class="panel-header-button right" title="Reset this table (clear filters, selected rows, etc.)" (click)="resetTable(TABLEINDEX.timecards, $event)"><i class="fal fa-history"></i></span>
        </span>
      </span>
    </p-header>
    <div #printAreaTimeCards class="table-wrapper" id="print-area-timecards">

      <!-- Begin TimeCard Reports table -->
      <p-table #timecardsTable [styleClass]="'timecards-table'" [columns]="selectedColumnsTimeCards" [value]="timecards" [resizableColumns]="true" [reorderableColumns]="colsReorder" [autoLayout]="autoLayout" [rows]="rowCount" [paginator]="showTableFoot" [pageLinks]="3" [rowsPerPageOptions]="pageSizeOptions" selectionMode="multiple" [(selection)]="selectedTimeCards" sortMode="multiple" [multiSortMeta]="timeCardsMultiSortMeta" [(contextMenuSelection)]="selectedTimeCards" [contextMenu]="reportsCM6">

        <!-- Caption area (column multiselect, date range filter, global search input) -->
        <ng-template pTemplate="caption">
          <div class="table-timecards-caption">
            <div class="column-choose-timecards-wrapper">
              <p-multiSelect #columnSelectTimeCards [styleClass]="'column-timecards-multiselect'" optionLabel="header" defaultLabel="Choose columns" [options]="colsTimeCards" [(ngModel)]="selectedColumnsTimeCards" [selectedItemsLabel]="selectedLabelTimeCards" (onChange)="selectionChangedTimeCards($event)"></p-multiSelect>
            </div>
            <div class="caption-right">
              <div class="date-wrapper">
                <span class="date-range-calendar-wrapper">
                  <p-calendar #dateRangeCalendarTimeCards [styleClass]="'date-range-calendar'" [(ngModel)]="dateRanges[TABLEINDEX.timecards - 1]" (onSelect)="checkDateRange(TABLEINDEX.timecards, dateRangeCalendarTimeCards, $event)" (onClose)="checkDateRangeOnClose(TABLEINDEX.timecards, dateRangeCalendarTimeCards, $event)" selectionMode="range" readonlyInput="true" showOtherMonths="true" selectOtherMonths="true" showIcon="true" placeholder="Date Range" title="Filter reports by this date range"></p-calendar>
                </span>
                <!-- <span class="header-button" title="Clear date filters" (click)="clearDates(timecardsTable, $event)"><i class="fa fa-times"></i></span> -->
                <span class="header-button" title="Clear date filters" (click)="clearTableDates(TABLEINDEX.timecards, timecardsTable, $event)"><i class="fa fa-times"></i></span>
              </div>
              <div class="global-filter-wrapper">
                <i class="global-filter-icon fa fa-search" style="margin:4px 4px 0 0"></i>
                <input #globalFilterInputTimeCards class="global-filter-input" type="text" pInputText size="50" placeholder="Global Search" (input)="timecardsTable.filterGlobal($event.target.value, 'contains')" style="width:auto">
              </div>
            </div>
          </div>
        </ng-template>

        <!-- Header area (col name, col sort icons, filter fields) -->
        <ng-template pTemplate="header" let-columns>
          <tr [class.reports-table-header]="true">
            <th [class.header-col-button]="true" [ngStyle]="styleColEdit" *ngIf="showButtonCol"></th>
            <th *ngFor="let col of columns; let i=index" [class.header-col]="true" [ngClass]="col?.class" [pSortableColumn]="col?.field" [ngStyle]="col?.style" [title]="col?.tooltip" pResizableColumn>
              {{col?.header}}
              <p-sortIcon [field]="col?.field"></p-sortIcon>
            </th>
          </tr>
          <tr class="reports-table-filter-row" *ngIf="showFilterRow">
            <th [class.header-col-button]="true" *ngIf="showButtonCol"></th>
            <th *ngFor="let col of columns" [class.filter-col]="true" [ngClass]="col?.class" [title]="col?.tooltip">
              <input [class.reports-col-filter]="true" pInputText type="text" [placeholder]="col?.filterPlaceholder" (input)="timecardsTable.filter($event.target.value, col.field, 'contains')">
            </th>
          </tr>
        </ng-template>

        <!-- TimeCard table body rows and columns (actual data) -->
        <ng-template pTemplate="body" let-rowData let-columns="columns" let-rowIndex="rowIndex">
          <tr [pSelectableRow]="rowData" [pSelectableRowIndex]="rowIndex">
            <td [class.button-col]="true" title="View time card" (click)="showReportTimeCard(rowData, $event)" *ngIf="showButtonCol">
              <span class="icon-button-wrapper">
                <i class="fal fa-edit work-reports-button-icon"></i>
              </span>
            </td>
            <td *ngFor="let col of columns; let i=index" [class.body-col]="true" [ngClass]="col?.class" [ngStyle]="col?.style">
              <span class="cell-body-data notes-wrapper" [title]="rowData[col?.field]" *ngIf="col.field === 'notes'">
                {{rowData[col?.field]}}
              </span>
              <span class="cell-body-data" *ngIf="col.field !== 'notes' && !col?.format">
                {{rowData[col?.field]}}
              </span>
              <span class="cell-body-data" *ngIf="col.field !== 'notes' && col?.format">
                {{moment(rowData[col?.field]).format(col?.format)}}
              </span>
            </td>
          </tr>
        </ng-template>

      </p-table>
      <!-- Table ended -->

    </div>
  </p-panel>
</ion-content>

<report-view #reportView *ngIf="reportViewVisible" [class.report-view-component]="true" [report]="report" [reports]="editReports" [tech]="tech" [site]="site" [sites]="sites" (save)="reportViewSave($event)" (cancel)="reportViewCancel($event)" (deleted)="reportViewDeleted($event)"></report-view>
<report-other-view #otherView *ngIf="reportOtherViewVisible" [class.report-view-component]="true" [other]="other" [others]="editOthers" [tech]="tech" [site]="site" [sites]="sites" (save)="otherViewSave($event)" (cancel)="otherViewCancel($event)" (deleted)="otherViewDeleted($event)"></report-other-view>
<report-logistics-view #logisticsView *ngIf="reportLogisticsViewVisible" [class.report-view-component]="true" [report]="logistic" [reports]="editLogistics" [tech]="tech" [site]="site" [sites]="sites" (save)="logisticsViewSave($event)" (cancel)="logisticsViewCancel($event)" (deleted)="logisticsViewDeleted($event)"></report-logistics-view>
<report-maintenance-view #maintenanceView *ngIf="reportMaintenanceViewVisible" [class.report-maintenance-component]="true" [report]="maintenance" [reports]="editMaintenance" [tech]="tech" [site]="site" [sites]="sites" (save)="maintenanceViewSave($event)" (cancel)="maintenanceViewCancel($event)" (deleted)="maintenanceViewDeleted($event)"></report-maintenance-view>
<report-driving-view #drivingView *ngIf="reportDrivingViewVisible" [class.report-driving-component]="true" [report]="driving" [reports]="editDriving" [tech]="tech" [site]="site" [sites]="sites" (save)="drivingViewSave($event)" (cancel)="drivingViewCancel($event)" (deleted)="drivingViewDeleted($event)"></report-driving-view>
<report-timecard-view #timecardView *ngIf="reportTimeCardViewVisible" [class.report-view-component]="true" [report]="timecard" [reports]="editTimeCards" [tech]="tech" [site]="site" [sites]="sites" (save)="timeCardViewSave($event)" (cancel)="timeCardViewCancel($event)" (deleted)="timeCardViewDeleted($event)"></report-timecard-view>

<p-contextMenu #reportsCM1 [model]="reportsMenu1"></p-contextMenu>
<p-contextMenu #reportsCM2 [model]="reportsMenu2"></p-contextMenu>
<p-contextMenu #reportsCM3 [model]="reportsMenu3"></p-contextMenu>
<p-contextMenu #reportsCM4 [model]="reportsMenu4"></p-contextMenu>
<p-contextMenu #reportsCM5 [model]="reportsMenu5"></p-contextMenu>
<p-contextMenu #reportsCM6 [model]="reportsMenu6"></p-contextMenu>
